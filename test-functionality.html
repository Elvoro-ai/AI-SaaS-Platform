<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Test des fonctionnalit√©s - AI SaaS Platform</title>
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="/modal-styles.css" />
  <style>
    .test-section {
      background: var(--panel);
      margin: 20px 0;
      padding: 24px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
    }
    
    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }
    
    .test-button {
      padding: 12px 16px;
      margin: 8px;
      border-radius: 8px;
      border: 1px solid var(--primary);
      background: transparent;
      color: var(--primary);
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
    }
    
    .test-button:hover {
      background: var(--primary);
      color: white;
    }
    
    .status {
      padding: 8px 12px;
      margin: 8px 0;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
    }
    
    .status.success {
      background: rgba(34, 197, 94, 0.2);
      color: var(--ok);
      border: 1px solid var(--ok);
    }
    
    .status.error {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
      border: 1px solid var(--danger);
    }
    
    .status.warning {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warn);
      border: 1px solid var(--warn);
    }
    
    .test-results {
      background: var(--bg);
      padding: 16px;
      border-radius: 8px;
      margin: 16px 0;
      border: 1px solid var(--border);
      font-family: monospace;
      font-size: 14px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .analytics-viewer {
      background: var(--bg);
      padding: 20px;
      border-radius: 12px;
      margin: 20px 0;
      border: 1px solid var(--border);
    }
    
    .event-item {
      padding: 12px;
      margin: 8px 0;
      background: var(--panel);
      border-radius: 8px;
      border-left: 4px solid var(--primary);
    }
    
    .event-time {
      color: var(--muted);
      font-size: 12px;
    }
    
    .clear-data {
      background: var(--danger);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      margin: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üß™ Test des Fonctionnalit√©s - AI SaaS Platform</h1>
      <p>Page de test pour valider tous les handlers onClick et modaux</p>
      <div>
        <a href="/" class="btn outline">Retour √† l'accueil</a>
        <a href="/app.html" class="btn primary">Ouvrir l'application</a>
      </div>
    </header>

    <!-- Test Section 1: Modal Components -->
    <section class="test-section">
      <h2>üì± Test des Modaux</h2>
      <p>Testez l'ouverture et la fermeture de tous les modaux</p>
      
      <div class="test-grid">
        <div>
          <h4>Modal d'inscription</h4>
          <button class="test-button" onclick="testModal('signup')">Tester Inscription</button>
          <div id="signup-status" class="status warning">Non test√©</div>
        </div>
        
        <div>
          <h4>Modal de connexion</h4>
          <button class="test-button" onclick="testModal('login')">Tester Connexion</button>
          <div id="login-status" class="status warning">Non test√©</div>
        </div>
        
        <div>
          <h4>Modal de d√©mo</h4>
          <button class="test-button" onclick="testModal('demo')">Tester D√©mo</button>
          <div id="demo-status" class="status warning">Non test√©</div>
        </div>
        
        <div>
          <h4>Modal de tarification</h4>
          <button class="test-button" onclick="testModal('pricing')">Tester Pricing</button>
          <div id="pricing-status" class="status warning">Non test√©</div>
        </div>
        
        <div>
          <h4>Modal de contact</h4>
          <button class="test-button" onclick="testModal('contact')">Tester Contact</button>
          <div id="contact-status" class="status warning">Non test√©</div>
        </div>
        
        <div>
          <h4>Modal mot de passe</h4>
          <button class="test-button" onclick="testModal('reset-password')">Tester Reset Password</button>
          <div id="reset-password-status" class="status warning">Non test√©</div>
        </div>
      </div>
    </section>

    <!-- Test Section 2: Landing Page Buttons -->
    <section class="test-section">
      <h2>üéØ Test des Boutons Landing Page</h2>
      <p>Simulation des boutons de la page d'accueil</p>
      
      <div class="test-grid">
        <div>
          <h4>CTA Principal (Hero)</h4>
          <input id="test-email" placeholder="test@example.com" type="email" style="width: 100%; margin-bottom: 8px;" />
          <button class="btn primary" onclick="testHeroCTA()">Commencer gratuitement</button>
          <div id="hero-cta-status" class="status warning">Non test√©</div>
        </div>
        
        <div>
          <h4>Ouvrir l'app (Header)</h4>
          <button class="btn primary" onclick="testOpenApp()">Ouvrir l'app</button>
          <div id="open-app-status" class="status warning">Non test√©</div>
        </div>
        
        <div>
          <h4>Plan Gratuit</h4>
          <button class="btn outline" onclick="testPlanSelection('free')">Choisir Gratuit</button>
          <div id="free-plan-status" class="status warning">Non test√©</div>
        </div>
        
        <div>
          <h4>Plan Pro</h4>
          <button class="btn primary" onclick="testPlanSelection('pro')">Choisir Pro</button>
          <div id="pro-plan-status" class="status warning">Non test√©</div>
        </div>
        
        <div>
          <h4>Plan Enterprise</h4>
          <button class="btn outline" onclick="testPlanSelection('enterprise')">Contacter</button>
          <div id="enterprise-plan-status" class="status warning">Non test√©</div>
        </div>
        
        <div>
          <h4>CTA D√©mo</h4>
          <button class="btn primary" onclick="testDemoCTA()">R√©server d√©mo</button>
          <div id="demo-cta-status" class="status warning">Non test√©</div>
        </div>
      </div>
    </section>

    <!-- Test Section 3: Form Submissions -->
    <section class="test-section">
      <h2>üìù Test des Soumissions de Formulaires</h2>
      <p>Test des fonctions de soumission sans ouvrir les modaux</p>
      
      <div class="test-grid">
        <div>
          <h4>Inscription Test</h4>
          <button class="test-button" onclick="testSignupSubmission()">Simuler inscription</button>
          <div id="signup-submit-status" class="status warning">Non test√©</div>
        </div>
        
        <div>
          <h4>Connexion Test</h4>
          <button class="test-button" onclick="testLoginSubmission()">Simuler connexion</button>
          <div id="login-submit-status" class="status warning">Non test√©</div>
        </div>
        
        <div>
          <h4>D√©mo Test</h4>
          <button class="test-button" onclick="testDemoSubmission()">Simuler r√©servation</button>
          <div id="demo-submit-status" class="status warning">Non test√©</div>
        </div>
        
        <div>
          <h4>Contact Test</h4>
          <button class="test-button" onclick="testContactSubmission()">Simuler contact</button>
          <div id="contact-submit-status" class="status warning">Non test√©</div>
        </div>
      </div>
    </section>

    <!-- Test Section 4: Analytics & Tracking -->
    <section class="test-section">
      <h2>üìà Analytics & Tracking</h2>
      <p>Visualisation des √©v√©nements track√©s</p>
      
      <div>
        <button class="btn outline" onclick="refreshAnalytics()">Actualiser les √©v√©nements</button>
        <button class="clear-data" onclick="clearAnalytics()">Vider les donn√©es</button>
        <button class="test-button" onclick="testTrackEvent()">Test Event Tracking</button>
      </div>
      
      <div class="analytics-viewer" id="analytics-viewer">
        <p>Chargement des √©v√©nements...</p>
      </div>
    </section>

    <!-- Test Section 5: Local Storage Data -->
    <section class="test-section">
      <h2>üíæ Donn√©es Locales</h2>
      <p>Visualisation des donn√©es stock√©es localement</p>
      
      <div>
        <button class="btn outline" onclick="refreshLocalData()">Actualiser les donn√©es</button>
        <button class="clear-data" onclick="clearAllData()">Vider toutes les donn√©es</button>
      </div>
      
      <div class="test-results" id="local-data-viewer">
        <p>Chargement des donn√©es locales...</p>
      </div>
    </section>

    <!-- Console de d√©bogage -->
    <section class="test-section">
      <h2>üêõ Console de D√©bogage</h2>
      <p>Messages de d√©bogage et erreurs</p>
      
      <div>
        <button class="btn outline" onclick="clearConsole()">Vider la console</button>
        <button class="test-button" onclick="testErrorHandling()">Test gestion d'erreurs</button>
      </div>
      
      <div class="test-results" id="debug-console">
        <p>Console pr√™te...</p>
      </div>
    </section>
  </div>

  <!-- Modal Container -->
  <div id="modal-container"></div>

  <!-- Scripts -->
  <script src="/modal-components.js"></script>
  <script src="/enhanced-script.js"></script>
  <script src="/script.js"></script>
  
  <!-- Test Scripts -->
  <script>
    let debugMessages = [];
    
    // Override console.log to capture messages
    const originalLog = console.log;
    console.log = function(...args) {
      originalLog.apply(console, args);
      debugMessages.push({
        type: 'log',
        message: args.join(' '),
        timestamp: new Date().toISOString()
      });
      updateDebugConsole();
    };
    
    // Override console.error to capture errors
    const originalError = console.error;
    console.error = function(...args) {
      originalError.apply(console, args);
      debugMessages.push({
        type: 'error',
        message: args.join(' '),
        timestamp: new Date().toISOString()
      });
      updateDebugConsole();
    };

    // Test Modal Functions
    function testModal(modalType) {
      try {
        console.log(`Testing modal: ${modalType}`);
        openModal(modalType);
        updateStatus(`${modalType}-status`, 'success', 'Modal ouvert avec succ√®s');
        
        // Auto-close after 3 seconds for testing
        setTimeout(() => {
          closeModal();
          console.log(`Modal ${modalType} ferm√© automatiquement`);
        }, 3000);
      } catch (error) {
        console.error(`Erreur lors du test du modal ${modalType}:`, error);
        updateStatus(`${modalType}-status`, 'error', `Erreur: ${error.message}`);
      }
    }

    // Test Hero CTA
    function testHeroCTA() {
      const email = document.getElementById('test-email').value;
      if (!email) {
        updateStatus('hero-cta-status', 'error', 'Email requis pour le test');
        return;
      }
      
      try {
        console.log(`Testing Hero CTA with email: ${email}`);
        saveLead(email, 'test_hero_cta');
        updateStatus('hero-cta-status', 'success', 'CTA test√© avec succ√®s');
        
        // Simulate signup flow
        setTimeout(() => {
          openModal('signup');
        }, 1000);
      } catch (error) {
        console.error('Erreur test Hero CTA:', error);
        updateStatus('hero-cta-status', 'error', `Erreur: ${error.message}`);
      }
    }

    // Test Open App
    function testOpenApp() {
      try {
        console.log('Testing Open App functionality');
        trackEvent('test_open_app_clicked', { source: 'test_page' });
        
        const isLoggedIn = localStorage.getItem('isLoggedIn');
        if (isLoggedIn) {
          updateStatus('open-app-status', 'success', 'Redirection vers app (utilisateur connect√©)');
          console.log('User is logged in, would redirect to /app.html');
        } else {
          updateStatus('open-app-status', 'success', 'Ouverture modal signup (utilisateur non connect√©)');
          setTimeout(() => openModal('signup'), 500);
        }
      } catch (error) {
        console.error('Erreur test Open App:', error);
        updateStatus('open-app-status', 'error', `Erreur: ${error.message}`);
      }
    }

    // Test Plan Selection
    function testPlanSelection(planType) {
      try {
        console.log(`Testing plan selection: ${planType}`);
        trackEvent('test_plan_selected', { plan: planType, source: 'test_page' });
        
        switch (planType) {
          case 'free':
            updateStatus('free-plan-status', 'success', 'Ouverture modal signup');
            setTimeout(() => openModal('signup'), 500);
            break;
          case 'pro':
            localStorage.setItem('intendedPlan', 'pro');
            updateStatus('pro-plan-status', 'success', 'Ouverture modal pricing');
            setTimeout(() => openModal('pricing'), 500);
            break;
          case 'enterprise':
            updateStatus('enterprise-plan-status', 'success', 'Ouverture modal contact');
            setTimeout(() => openModal('contact'), 500);
            break;
        }
      } catch (error) {
        console.error(`Erreur test plan ${planType}:`, error);
        updateStatus(`${planType}-plan-status`, 'error', `Erreur: ${error.message}`);
      }
    }

    // Test Demo CTA
    function testDemoCTA() {
      try {
        console.log('Testing Demo CTA');
        trackEvent('test_demo_cta_clicked', { source: 'test_page' });
        updateStatus('demo-cta-status', 'success', 'Ouverture modal d√©mo');
        setTimeout(() => openModal('demo'), 500);
      } catch (error) {
        console.error('Erreur test Demo CTA:', error);
        updateStatus('demo-cta-status', 'error', `Erreur: ${error.message}`);
      }
    }

    // Test Form Submissions
    function testSignupSubmission() {
      try {
        console.log('Testing signup submission');
        const testData = {
          email: 'test@example.com',
          name: 'Test User',
          company: 'Test Company',
          password: 'testpassword123'
        };
        
        // Simulate form data processing
        const userData = {
          ...testData,
          createdAt: new Date().toISOString(),
          plan: 'free',
          credits: 100
        };
        
        localStorage.setItem('user', JSON.stringify(userData));
        localStorage.setItem('isLoggedIn', 'true');
        
        updateStatus('signup-submit-status', 'success', 'Simulation inscription r√©ussie');
        console.log('Signup simulation completed successfully');
      } catch (error) {
        console.error('Erreur test signup:', error);
        updateStatus('signup-submit-status', 'error', `Erreur: ${error.message}`);
      }
    }

    function testLoginSubmission() {
      try {
        console.log('Testing login submission');
        const storedUser = localStorage.getItem('user');
        if (storedUser) {
          localStorage.setItem('isLoggedIn', 'true');
          updateStatus('login-submit-status', 'success', 'Simulation connexion r√©ussie');
          console.log('Login simulation completed successfully');
        } else {
          updateStatus('login-submit-status', 'error', 'Aucun utilisateur en m√©moire (cr√©ez d\'abord un compte test)');
        }
      } catch (error) {
        console.error('Erreur test login:', error);
        updateStatus('login-submit-status', 'error', `Erreur: ${error.message}`);
      }
    }

    function testDemoSubmission() {
      try {
        console.log('Testing demo submission');
        const demoData = {
          name: 'Test User',
          email: 'test@example.com',
          company: 'Test Company',
          timestamp: new Date().toISOString()
        };
        
        const existingDemos = JSON.parse(localStorage.getItem('demoRequests') || '[]');
        existingDemos.push(demoData);
        localStorage.setItem('demoRequests', JSON.stringify(existingDemos));
        
        updateStatus('demo-submit-status', 'success', 'Simulation r√©servation d√©mo r√©ussie');
        console.log('Demo booking simulation completed successfully');
      } catch (error) {
        console.error('Erreur test demo:', error);
        updateStatus('demo-submit-status', 'error', `Erreur: ${error.message}`);
      }
    }

    function testContactSubmission() {
      try {
        console.log('Testing contact submission');
        const contactData = {
          name: 'Test User',
          email: 'test@example.com',
          company: 'Test Company',
          message: 'Test message for contact form',
          timestamp: new Date().toISOString()
        };
        
        const existingContacts = JSON.parse(localStorage.getItem('contactRequests') || '[]');
        existingContacts.push(contactData);
        localStorage.setItem('contactRequests', JSON.stringify(existingContacts));
        
        updateStatus('contact-submit-status', 'success', 'Simulation contact r√©ussie');
        console.log('Contact submission simulation completed successfully');
      } catch (error) {
        console.error('Erreur test contact:', error);
        updateStatus('contact-submit-status', 'error', `Erreur: ${error.message}`);
      }
    }

    // Analytics Functions
    function testTrackEvent() {
      try {
        trackEvent('test_event', {
          test_data: 'sample data',
          timestamp: new Date().toISOString(),
          user_agent: navigator.userAgent
        });
        console.log('Test event tracked successfully');
        refreshAnalytics();
      } catch (error) {
        console.error('Erreur test tracking:', error);
      }
    }

    function refreshAnalytics() {
      try {
        const events = JSON.parse(localStorage.getItem('analyticsEvents') || '[]');
        const viewer = document.getElementById('analytics-viewer');
        
        if (events.length === 0) {
          viewer.innerHTML = '<p>Aucun √©v√©nement track√© pour le moment.</p>';
          return;
        }
        
        const eventsHtml = events.slice(-10).reverse().map(event => `
          <div class="event-item">
            <strong>${event.event}</strong>
            <div class="event-time">${new Date(event.timestamp).toLocaleString('fr-FR')}</div>
            <pre>${JSON.stringify(event.data, null, 2)}</pre>
          </div>
        `).join('');
        
        viewer.innerHTML = `<h4>Derniers √©v√©nements (${events.length} total)</h4>${eventsHtml}`;
      } catch (error) {
        console.error('Erreur refresh analytics:', error);
      }
    }

    function clearAnalytics() {
      localStorage.removeItem('analyticsEvents');
      refreshAnalytics();
      console.log('Analytics cleared');
    }

    // Local Storage Functions
    function refreshLocalData() {
      try {
        const viewer = document.getElementById('local-data-viewer');
        const data = {
          user: localStorage.getItem('user'),
          isLoggedIn: localStorage.getItem('isLoggedIn'),
          leads: localStorage.getItem('leads'),
          demoRequests: localStorage.getItem('demoRequests'),
          contactRequests: localStorage.getItem('contactRequests'),
          userCredits: localStorage.getItem('userCredits'),
          HF_KEY: localStorage.getItem('HF_KEY') ? '[CL√â MASQU√âE]' : null
        };
        
        const dataHtml = Object.entries(data)
          .filter(([key, value]) => value !== null)
          .map(([key, value]) => {
            try {
              const parsed = key !== 'HF_KEY' ? JSON.parse(value) : value;
              return `<div><strong>${key}:</strong><br><pre>${JSON.stringify(parsed, null, 2)}</pre></div>`;
            } catch {
              return `<div><strong>${key}:</strong> ${value}</div>`;
            }
          }).join('<hr>');
        
        viewer.innerHTML = dataHtml || '<p>Aucune donn√©e locale stock√©e.</p>';
      } catch (error) {
        console.error('Erreur refresh local data:', error);
      }
    }

    function clearAllData() {
      const keys = ['user', 'isLoggedIn', 'leads', 'demoRequests', 'contactRequests', 'analyticsEvents', 'userCredits'];
      keys.forEach(key => localStorage.removeItem(key));
      refreshLocalData();
      refreshAnalytics();
      console.log('All local data cleared');
    }

    // Debug Console Functions
    function updateDebugConsole() {
      const console = document.getElementById('debug-console');
      if (!console) return;
      
      const messagesHtml = debugMessages.slice(-20).reverse().map(msg => `
        <div style="margin: 8px 0; padding: 8px; background: var(--panel); border-radius: 4px; border-left: 4px solid ${msg.type === 'error' ? 'var(--danger)' : 'var(--primary)'}">
          <div style="color: var(--muted); font-size: 12px;">${new Date(msg.timestamp).toLocaleTimeString()}</div>
          <div style="color: ${msg.type === 'error' ? 'var(--danger)' : 'var(--text)'}">[${msg.type.toUpperCase()}] ${msg.message}</div>
        </div>
      `).join('');
      
      console.innerHTML = messagesHtml || '<p>Aucun message de d√©bogage.</p>';
    }

    function clearConsole() {
      debugMessages = [];
      updateDebugConsole();
    }

    function testErrorHandling() {
      try {
        // Intentionally cause an error
        throw new Error('Test error for debugging purposes');
      } catch (error) {
        console.error('Test error caught:', error.message);
      }
    }

    // Utility Functions
    function updateStatus(elementId, type, message) {
      const element = document.getElementById(elementId);
      if (element) {
        element.className = `status ${type}`;
        element.textContent = message;
      }
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Test page initialized');
      refreshAnalytics();
      refreshLocalData();
      
      // Track page visit
      trackEvent('test_page_visited', {
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent
      });
    });
  </script>
</body>
</html>